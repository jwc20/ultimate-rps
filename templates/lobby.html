<!DOCTYPE html>
<html>
<head>
    <title>Game Lobby</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .room-list {
            border: 1px solid #ccc;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .room-item {
            border: 1px solid #ddd;
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }

        .button {
            background: #007cba;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .button:hover {
            background: #005a8a;
        }

        input[type="text"] {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        .player-info {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<h1>Lobby</h1>

<div class="player-info">
    <h3>Player: <span id="player-name"></span></h3>
    <p>Player ID: <span id="player-id"></span></p>
</div>

<div class="room-list">
    <h2>Create New Room</h2>
    <form action="/create_room" method="post">
        <input type="hidden" name="player_id" id="create-player-id">
        <input type="text" name="room_name" placeholder="Room Name" required>
        <button type="submit" class="button">Create Room</button>
    </form>
</div>

<div class="room-list">
    <h2>Available Rooms</h2>
    <div id="rooms-container">
        <p>Loading rooms...</p>
    </div>
    <button onclick="loadRooms()" class="button">Refresh Rooms</button>
</div>

<script>
    // Get player info from URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const playerId = urlParams.get('player_id');
    const playerName = urlParams.get('player_name');

    if (!playerId || !playerName) {
        // Redirect to login if no player info
        window.location.href = '/login';
    }

    document.getElementById('player-name').textContent = playerName;
    document.getElementById('player-id').textContent = playerId;
    document.getElementById('create-player-id').value = playerId;

    async function loadRooms() {
        try {
            const response = await fetch('/api/rooms');
            const rooms = await response.json();
            const container = document.getElementById('rooms-container');

            if (rooms.length === 0) {
                container.innerHTML = '<p>No rooms available. Create one!</p>';
                return;
            }

            container.innerHTML = rooms.map(room => `
                    <div class="room-item">
                        <h4>${room.name}</h4>
                        <p>Players: ${room.player_count}/${room.max_players}</p>
                        <p>Room ID: ${room.id}</p>
                        <form action="/join_room" method="post" style="display: inline;">
                            <input type="hidden" name="player_id" value="${playerId}">
                            <input type="hidden" name="room_id" value="${room.id}">
                            <button type="submit" class="button" ${room.player_count >= room.max_players ? 'disabled' : ''}>
                                ${room.player_count >= room.max_players ? 'Room Full' : 'Join Room'}
                            </button>
                        </form>
                    </div>
                `).join('');
        } catch (error) {
            console.error('Error loading rooms:', error);
        }
    }

    // Load rooms on page load
    loadRooms();

    // Auto-refresh rooms every 5 seconds
    setInterval(loadRooms, 5000);
</script>
</body>
</html>